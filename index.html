<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Matching Game</title>

<style>
* { box-sizing: border-box; }

body {
    margin: 0;
    height: 100dvh;
    display: flex;
    background: #111;
    color: #fff;
    font-family: Arial, sans-serif;
    overflow: hidden;
}

/* LEFT PANEL */
#sidebar {
    width: 220px;
    padding: 15px;
    background: #222;
    display: flex;
    flex-direction: column;
    gap: 12px;
}

select, button {
    width: 100%;
    padding: 6px;
    font-size: 16px;
}

#end-controls {
    display: none;
    margin-top: auto;
    gap: 8px;
}

/* GAME AREA */
#game-wrapper {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: center;
}

#game-container {
    display: grid;
    /* background-image: url("background.jpg"); */
	background-color: #000;  /* initial color */
	background-size: cover;
	background-position: center;
}

/* TILE */
.cell {
    position: relative;
    cursor: pointer;
	background-color: #000;
    background-size: cover;
    background-position: center;
}

.cell.hidden {
    background-image: url("button.jpg");
}

.cell.revealed {
    cursor: default;
}

.cell.clearing {
    animation: flipAway 0.6s cubic-bezier(0.4, 0, 0.2, 1) forwards;
    pointer-events: none;
}

/* FLIP ANIMATION */
@keyframes flipAway {
    0%   { transform: rotateY(0deg); opacity: 1; }
    100% { transform: rotateY(180deg); opacity: 0; }
}

@media (orientation: portrait) {
    body {
        flex-direction: column;
    }

    #sidebar {
        width: 100%;
        flex-direction: row;
        flex-wrap: wrap;
        align-items: center;
        justify-content: center;
        gap: 8px;
    }

    #sidebar label {
        display: flex;
        align-items: center;
        gap: 4px;
        white-space: nowrap;
    }

    #sidebar select,
    #sidebar button {
        width: auto;
    }

    #game-wrapper {
        flex: 1;
        min-height: 0;
    }
	
	@media (hover: none) and (pointer: coarse) {
    	button,
    	select {
       		font-size: 18px;
        	padding: 10px 12px;
    	}

    	#sidebar {
       		gap: 12px;
    	}
	}
}

.top-controls {
    display: flex;
    align-items: center;   /* keeps Start vertically fixed */
    gap: 8px;
    position: relative;   /* anchor for dropdown */
}

/* Gear dropdown */
#settings {
    position: relative;
}

#settings summary {
    cursor: pointer;
    list-style: none;
    padding: 6px 10px;
    background: #333;
    border-radius: 4px;
    font-size: 18px;
}

#settings summary::-webkit-details-marker {
    display: none;
}
    .top-controls {
        justify-content: center;
    }
}

#settings label {
    display: grid;
    grid-template-columns: auto auto;
    align-items: center;
    gap: 6px;
    margin-bottom: 6px;
}

/* (Optional) smaller selects inside the dropdown */
#settings select {
    font-size: 14px;
    padding: 4px 6px;
}	
	
#settings[open] {
    position: absolute;
    top: 100%;           /* below the gear */
    right: 0;
    background: #222;
    padding: 10px;
    border-radius: 6px;
    z-index: 100;
    min-width: 160px;
}
</style>
</head>

<body>

<div id="sidebar">
    <h3>Matching Game</h3>

    <div class="top-controls">
        <button onclick="startGame()">Start Game</button>

        <details id="settings">
            <summary aria-label="Settings">‚öôÔ∏è</summary>

            <label>Rows
                <select id="rows">
                    <option selected>4</option>
                    <option>5</option>
                    <option>6</option>
                </select>
            </label>

            <label>Columns
                <select id="cols">
                    <option selected>4</option>
                    <option>5</option>
                    <option>6</option>
                </select>
            </label>

            <button id="muteBtn">üîä Sound On</button>
        </details>
    </div>

    <div id="end-controls">
        <button>All Done!</button>
    </div>
</div>


<div id="game-wrapper">
    <div id="game-container"></div>
</div>

<script>
/* ---------- CONFIG ---------- */
const DELAY = 2000;
const flipSound = new Audio("match.mp3");
flipSound.volume = 0.6; // optional, but recommended
/*
const muteToggle = document.getElementById("muteToggle");

muteToggle.addEventListener("change", () => {
    flipSound.muted = muteToggle.checked;
});*/
const preloadList = [
    "button.jpg",
    "background.jpg",
	"wild.jpg",
	"img01.jpg",
 	"img02.jpg",
	"img03.jpg",
	"img04.jpg",
	"img05.jpg",
	"img06.jpg",
	"img07.jpg",
	"img08.jpg",
	"img09.jpg",
	"img10.jpg",
	"img11.jpg",
	"img12.jpg",
	"img13.jpg",
	"img14.jpg",
	"img15.jpg",
	"img16.jpg",
	"img17.jpg",
	"img18.jpg"
];

/* ---------- STATE ---------- */
let firstPick = null;
let secondPick = null;
let lockBoard = false;
let remaining = 0;
let rows = 6, cols = 6;
let backgroundShown = false;

/* ---------- ELEMENTS ---------- */
const rowsEl = document.getElementById("rows");
const colsEl = document.getElementById("cols");
const game = document.getElementById("game-container");
const wrapper = document.getElementById("game-wrapper");
const endControls = document.getElementById("end-controls");

const muteBtn = document.getElementById("muteBtn");

muteBtn.onclick = () => {
    flipSound.muted = !flipSound.muted;
    muteBtn.textContent = flipSound.muted ? "üîá Sound Off" : "üîä Sound On";
};

/* ---------- GAME START ---------- */
function startGame() {
	document.getElementById("settings")?.removeAttribute("open");

    rows = +rowsEl.value;
    cols = +colsEl.value;

    const total = rows * cols;
    if (total % 2 !== 0 && total !== 25) {
        alert("Invalid grid size");
        return;
    }

    game.innerHTML = "";
    endControls.style.display = "none";
    firstPick = secondPick = null;
    lockBoard = false;

    resizeGrid();
	
	const TOTAL_IMAGES = 18;
	const arr = Array.from({ length: TOTAL_IMAGES }, (_, i) => i + 1);
	
	for (let i = arr.length -1; i > 0; i--) {
		const j = Math.floor(Math.random() * (i + 1));
		[arr[i], arr[j]] = [arr[j], arr[i]];
	}
	
    let images = [];

    if (rows === 5 && cols === 5) {
        for (let i = 0; i < 12; i++) {
            images.push(img(arr[i]), img(arr[i]));
        }
        images.push("wild.jpg");
    } else {
        for (let i = 0; i < total / 2; i++) {
            images.push(img(arr[i]), img(arr[i]));
        }
    }

    shuffle(images);
    remaining = images.length;

	preloadImages(preloadList, () => {
		game.style.gridTemplateColumns = `repeat(${cols}, 1fr)`;
		game.style.gridTemplateRows = `repeat(${rows}, 1fr)`;
		images.forEach(src => game.appendChild(makeCell(src)));
	});
}

/* -------  Preload --------- */
function preloadImages(srcs, callback) {
    let loaded = 0;
    srcs.forEach(src => {
        const img = new Image();
        img.onload = img.onerror = () => {
            loaded++;
            if (loaded === srcs.length) callback();
        };
        img.src = src;
    });
}

/* ---------- CELL ---------- */
function makeCell(src) {
    const cell = document.createElement("div");
    cell.className = "cell hidden";
    cell.dataset.image = src;
    cell.onclick = () => handleClick(cell);
    return cell;
}

/* ---------- INTERACTION ---------- */
function handleClick(cell) {
    if (lockBoard || cell === firstPick || cell.classList.contains("clearing")) return;

    reveal(cell);

    if (!firstPick) {
        firstPick = cell;
        return;
    }

    secondPick = cell;
    lockBoard = true;

    if (isWild(firstPick, secondPick)) {
        handleWild();
    } else {
        setTimeout(checkMatch, DELAY);
    }
}

function reveal(cell) {
    cell.classList.remove("hidden");
    cell.classList.add("revealed");
    cell.style.backgroundImage = `url("${cell.dataset.image}")`;
}

function hide(cell) {
    cell.classList.add("hidden");
    cell.classList.remove("revealed");
    cell.style.backgroundImage = 'url("button.jpg")';
}

/* ---------- MATCHING ---------- */
function checkMatch() {
    if (firstPick.dataset.image === secondPick.dataset.image) {
        clearCells([firstPick, secondPick]);
    } else {
        hide(firstPick);
        hide(secondPick);
    }
    resetTurn();
}

function handleWild() {
    const target = firstPick.dataset.image === "wild.jpg"
        ? secondPick.dataset.image
        : firstPick.dataset.image;

    const matches = [...document.querySelectorAll(
        `.cell[data-image="${target}"]:not(.clearing)`
    )];

    matches.forEach(reveal);

    setTimeout(() => {
        clearCells([...matches, firstPick, secondPick]);
        resetTurn();
    }, DELAY);
}

/* ---------- CLEARING ---------- */
function clearCells(cells) {
    flipSound.currentTime = 0;
    flipSound.play();

    // show background only once
    if (!backgroundShown) {
        game.style.backgroundImage = 'url("background.jpg")';
        backgroundShown = true;
    }

    cells.forEach(cell => {
        cell.classList.add("clearing");
        setTimeout(() => {
            cell.style.visibility = "hidden";
            remaining--;
            if (!remaining) endControls.style.display = "flex";
        }, 600);
    });
}

/* ---------- UTIL ---------- */
function resetTurn() {
    firstPick = secondPick = null;
    lockBoard = false;
}

function resizeGrid() {
    const size = Math.floor(Math.min(
        wrapper.clientWidth / cols,
        wrapper.clientHeight / rows
    ));
    game.style.width = size * cols + "px";
    game.style.height = size * rows + "px";
    document.querySelectorAll(".cell").forEach(c => {
        c.style.width = c.style.height = size + "px";
    });
}

window.addEventListener("resize", resizeGrid);

function shuffle(a) {
    for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
    }
}

function img(i) {
    return `img${String(i).padStart(2, "0")}.jpg`;
}

function isWild(a, b) {
    return a.dataset.image === "wild.jpg" || b.dataset.image === "wild.jpg";
}

function handleEndChoice() {
    document.getElementById("end-choice").value === "restart"
        ? startGame()
        : game.innerHTML = "";
}
</script>

</body>
</html>


